<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- 
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License. 
-->
<html>
<head>
    <link type="text/css" rel="stylesheet" href="https://struts.apache.org/css/default.css">
    <style type="text/css">
        .dp-highlighter {
            width:95% !important;
        }
    </style>
    <style type="text/css">
        .footer {
            background-image:      url('https://cwiki.apache.org/confluence/images/border/border_bottom.gif');
            background-repeat:     repeat-x;
            background-position:   left top;
            padding-top:           4px;
            color:                 #666;
        }
    </style>
    <script type="text/javascript" language="javascript">
        var hide = null;
        var show = null;
        var children = null;

        function init() {
            /* Search form initialization */
            var form = document.forms['search'];
            if (form != null) {
                form.elements['domains'].value = location.hostname;
                form.elements['sitesearch'].value = location.hostname;
            }

            /* Children initialization */
            hide = document.getElementById('hide');
            show = document.getElementById('show');
            children = document.all != null ?
                    document.all['children'] :
                    document.getElementById('children');
            if (children != null) {
                children.style.display = 'none';
                show.style.display = 'inline';
                hide.style.display = 'none';
            }
        }

        function showChildren() {
            children.style.display = 'block';
            show.style.display = 'none';
            hide.style.display = 'inline';
        }

        function hideChildren() {
            children.style.display = 'none';
            show.style.display = 'inline';
            hide.style.display = 'none';
        }
    </script>
    <title>AJAX Validation</title>
</head>
<body onload="init()">
<table border="0" cellpadding="2" cellspacing="0" width="100%">
    <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
            &nbsp;<a href="home.html">Home</a>&nbsp;&gt;&nbsp;<a href="guides.html">Guides</a>&nbsp;&gt;&nbsp;<a href="core-developers-guide.html">Core Developers Guide</a>&nbsp;&gt;&nbsp;<a href="validation.html">Validation</a>&nbsp;&gt;&nbsp;<a href="client-side-validation.html">Client Side Validation</a>&nbsp;&gt;&nbsp;<a href="pure-javascript-client-side-validation.html">Pure JavaScript Client Side Validation</a>&nbsp;&gt;&nbsp;<a href="ajax-client-side-validation.html">AJAX Client Side Validation</a>&nbsp;&gt;&nbsp;<a href="ajax-validation.html">AJAX Validation</a>
        </td>
        <td align="right" valign="middle" nowrap>
            <form name="search" action="https://www.google.com/search" method="get">
                <input type="hidden" name="ie" value="UTF-8" />
                <input type="hidden" name="oe" value="UTF-8" />
                <input type="hidden" name="domains" value="" />
                <input type="hidden" name="sitesearch" value="" />
                <input type="text" name="q" maxlength="255" value="" />
                <input type="submit" name="btnG" value="Google Search" />
            </form>
        </td>
    </tr>
</table>

<div id="PageContent">
    <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="/wiki/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Struts 2 Documentation</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">AJAX Validation</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=13850">
                <img src="https://cwiki.apache.org/confluence/images/icons/notep_16.gif"
                     height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=13850">Edit Page</a>
            &nbsp;
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=WW">
                <img src="https://cwiki.apache.org/confluence/images/icons/browse_space.gif"
                     height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=WW">Browse Space</a>
            &nbsp;
            <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=WW&fromPageId=13850">
                <img src="https://cwiki.apache.org/confluence/images/icons/add_page_16.gif"
                     height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=WW&fromPageId=13850">Add Page</a>
            &nbsp;
            <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=WW&fromPageId=13850">
                <img src="https://cwiki.apache.org/confluence/images/icons/add_blogentry_16.gif"
                     height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
            <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=WW&fromPageId=13850">Add News</a>
        </div>
    </div>

    <div class="pagecontent">
        <div class="wiki-content">
            <div id="ConfluenceContent"><h2 id="AJAXValidation-Description">Description</h2><p>Struts provides <a shape="rect" href="client-validation.html">client side validation</a>(using JavaScript) for a few validators. Using AJAX validation, all <a shape="rect" href="validation.html">validators</a> available to the application on the server side can be used without forcing the page to reload, just to show validation errors. AJAX validation has a server side, which is in included in <a shape="rect" href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=34268">JSON Plugin</a> (an interceptor and a result). Client side must be handled by applictions themself. One reason for that is there are too many JavaScript frameworks and libraries. Struts has no preference which of them you use. Previous versions of Struts included a client side which was relying on the Dojo JS framework and was located in Struts Dojo plugin. That has been deprecated for a long time and was eventually removed.</p><h2 id="AJAXValidation-Example">Example</h2><p>This example is taken from the Struts showcase application.</p><h3 id="AJAXValidation-Createtheactionclass">Create the action class</h3><parameter ac:name="language">java</parameter><plain-text-body>public class AjaxFormSubmitAction extends ActionSupport {
    private String requiredValidatorField = null;
    private String requiredStringValidatorField = null;
    private Integer integerValidatorField = null;
    private Date dateValidatorField = null;
    private String emailValidatorField = null;
    private String urlValidatorField = null;
    private String stringLengthValidatorField = null;
    private String regexValidatorField = null;
    private String fieldExpressionValidatorField = null;
    @Override
    public void validate() {
        if (hasFieldErrors()) {
            addActionError("Errors present!");
        }
    }
    public Date getDateValidatorField() {
        return dateValidatorField;
    }
    @DateRangeFieldValidator(
        min="01/01/1990", 
        max="01/01/2000", 
        message="must be a min 01-01-1990 max 01-01-2000 if supplied")
    public void setDateValidatorField(Date dateValidatorField) {
        this.dateValidatorField = dateValidatorField;
    }
    public String getEmailValidatorField() {
        return emailValidatorField;
    }
    @EmailValidator(message="must be a valid email if supplied")
    public void setEmailValidatorField(String emailValidatorField) {
        this.emailValidatorField = emailValidatorField;
    }
    public Integer getIntegerValidatorField() {
        return integerValidatorField;
    }
    @IntRangeFieldValidator(min="1", max="10", message="must be integer min 1 max 10 if supplied")
    public void setIntegerValidatorField(Integer integerValidatorField) {
        this.integerValidatorField = integerValidatorField;
    }
    public String getRegexValidatorField() {
        return regexValidatorField;
    }
    @RegexFieldValidator(
        regex="[^&lt;&gt;]+", 
        message="regexValidatorField must match a regexp (.*\\.txt) if specified")
    public void setRegexValidatorField(String regexValidatorField) {
        this.regexValidatorField = regexValidatorField;
    }
    public String getRequiredStringValidatorField() {
        return requiredStringValidatorField;
    }
    @RequiredStringValidator(trim=true, message="required and must be string")
    public void setRequiredStringValidatorField(String requiredStringValidatorField) {
        this.requiredStringValidatorField = requiredStringValidatorField;
    }
    public String getRequiredValidatorField() {
        return requiredValidatorField;
    }
    @RequiredFieldValidator(message="required")
    public void setRequiredValidatorField(String requiredValidatorField) {
        this.requiredValidatorField = requiredValidatorField;
    }
    public String getStringLengthValidatorField() {
        return stringLengthValidatorField;
    }
    @StringLengthFieldValidator(
        minLength="2", 
        maxLength="4", 
        trim=true, 
        message="must be a String of a specific greater than 1 less than 5 if specified")
    public void setStringLengthValidatorField(String stringLengthValidatorField) {
        this.stringLengthValidatorField = stringLengthValidatorField;
    }
    public String getFieldExpressionValidatorField() {
        return fieldExpressionValidatorField;
    }
    @FieldExpressionValidator(
        expression = "(fieldExpressionValidatorField == requiredValidatorField)", 
        message = "must be the same as the Required Validator Field if specified")
    public void setFieldExpressionValidatorField(
            String fieldExpressionValidatorField) {
        this.fieldExpressionValidatorField = fieldExpressionValidatorField;
    }
    public String getUrlValidatorField() {
        return urlValidatorField;
    }
    @UrlValidator(message="must be a valid url if supplied")
    public void setUrlValidatorField(String urlValidatorField) {
        this.urlValidatorField = urlValidatorField;
    }
}</plain-text-body><p>&#160;</p><h3 id="AJAXValidation-MaptheAction">Map the Action</h3><p>Note that is is not necessary when using <a shape="rect" href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=73711">Convention Plugin</a>.</p><parameter ac:name="">XML</parameter><plain-text-body>&lt;!DOCTYPE struts PUBLIC "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN" "http://struts.apache.org/dtds/struts-2.0.dtd"&gt;
	
&lt;struts&gt;
    &lt;package&gt;
         &lt;action name="ajaxFormSubmit" class="org.apache.struts2.showcase.validation.AjaxFormSubmitAction"&gt;
             &lt;interceptor-ref name="jsonValidationWorkflowStack"/&gt;
             &lt;result name="input"&gt;/WEB-INF/validation/ajaxFormSubmit.jsp&lt;/result&gt;
             &lt;result type="jsonActionRedirect"&gt;ajaxFormSubmitSuccess&lt;/result&gt;
         &lt;/action&gt;
    &lt;/package&gt;
</plain-text-body><p>AJAX validation is performed by the <em>jsonValidation</em> interceptor. This interceptor is included in the <em>jsonValidationWorkflowStack</em>, and is required in order to perform AJAX validation. Normal results(input, success, etc) should be provided for the action in the case that someone tries to access the action directly, in which case normal validation will be triggered. So, how does the <em>jsonValidation</em> know that it must perform AJAX validation vs regular validation? We will see that in a minute, but you don't need to know that in order to use AJAX validation. Same applies for specialized Redirect Result Type <em>jsonActionRedirect</em>.</p><h3 id="AJAXValidation-CreatetheJSP">Create the JSP</h3><parameter ac:name="">HTML</parameter><plain-text-body>&lt;%@taglib prefix="s" uri="/struts-tags" %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Struts2 Showcase - Validation - AJAX Form Submit&lt;/title&gt;
    &lt;s:head theme="xhtml"/&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class="page-header"&gt;
    &lt;h1&gt;AJAX Form Submit&lt;/h1&gt;
&lt;/div&gt;
    &lt;h3&gt;Action Errors Will Appear Here&lt;/h3&gt;
    &lt;s:actionerror theme="ajaxErrorContainers"/&gt;
    &lt;hr/&gt;
    &lt;s:form method="POST" theme="xhtml"&gt;
        &lt;s:textfield label="Required Validator Field" name="requiredValidatorField" theme="ajaxErrorContainers"/&gt;
        &lt;s:textfield label="Required String Validator Field" name="requiredStringValidatorField" theme="ajaxErrorContainers"/&gt;
        &lt;s:textfield label="Integer Validator Field" name="integerValidatorField" theme="ajaxErrorContainers"/&gt;
        &lt;s:textfield label="Date Validator Field" name="dateValidatorField" theme="ajaxErrorContainers"/&gt;
        &lt;s:textfield label="Email Validator Field" name="emailValidatorField" theme="ajaxErrorContainers"/&gt;
        &lt;s:textfield label="URL Validator Field" name="urlValidatorField" theme="ajaxErrorContainers"/&gt;
        &lt;s:textfield label="String Length Validator Field" name="stringLengthValidatorField" theme="ajaxErrorContainers"/&gt;
        &lt;s:textfield label="Regex Validator Field" name="regexValidatorField" theme="ajaxErrorContainers"/&gt;
        &lt;s:textfield label="Field Expression Validator Field" name="fieldExpressionValidatorField" theme="ajaxErrorContainers"/&gt;
        &lt;s:submit label="Submit" cssClass="btn btn-primary"/&gt;
    &lt;/s:form&gt;
&lt;/body&gt;
&lt;/html&gt;&#160;</plain-text-body><p>Things to note on this JSP:</p><ul><li>The <em>form</em> tag <strong>does not</strong> have <em>validate</em> set to <em>true</em>, which would perform client validation before the AJAX validation.</li><li>It uses a customized theme <em>ajaxErrorContainers</em>. The default Struts themes generate HTML-Elements to show validation errors only if errors are present when page is created on server side. But in order to show validation errors that arrive later via AJAX it is necessary to have error-container elements in DOM always.</li></ul><p>What happens if validation succeeds? That depends on your request parameters and action configuration. If you are using <em>jsonActionRedirect</em> result mentioned above the action will be executed while AJAX request is active and respond with JSON providing a new URL to load. Otherwise the AJAX response will be empty and the form must be submitted a 2nd time but as usual request, not AJAX.</p><parameter ac:name="">Client Validation</parameter><rich-text-body><p>Setting <em>validate</em> to <em>true</em> in the <em>form</em> tag will enable client side, JavaScript validation, which can be used along with AJAX validation (runs before the AJAX validation).</p></rich-text-body><h3 id="AJAXValidation-CustomTheme">Custom Theme</h3><p>In this sample the&#160;<a shape="rect" href="struts-2-themes.html">custom theme</a> is based on <em>xhtml</em> theme. It is required to override 3 FTL files.</p><pre>theme.properties</pre><parameter ac:name="language">text</parameter><plain-text-body>parent = xhtml</plain-text-body><p>&#160;</p><pre>actionerror.ftl</pre><parameter ac:name="language">xml</parameter><plain-text-body>&lt;#--
    Make sure element is always present. To be filled later via JS.
--&gt;
&lt;ul&lt;#rt/&gt;
&lt;#if parameters.id??&gt;
 id="${parameters.id?html}"&lt;#rt/&gt;
&lt;/#if&gt;            
&lt;#if parameters.cssClass??&gt;
 class="${parameters.cssClass?html}"&lt;#rt/&gt;
&lt;#else&gt;
 class="errorMessage"&lt;#rt/&gt;
&lt;/#if&gt;
&lt;#if parameters.cssStyle??&gt;
 style="${parameters.cssStyle?html}"&lt;#rt/&gt;
&lt;/#if&gt;
&gt;
&lt;#if (actionErrors?? &amp;&amp; actionErrors?size &gt; 0)&gt;
    &lt;#list actionErrors as error&gt;
        &lt;#if error??&gt;
            &lt;li&gt;&lt;span&gt;&lt;#if parameters.escape&gt;${error!?html}&lt;#else&gt;${error!}&lt;/#if&gt;&lt;/span&gt;&lt;#rt/&gt;&lt;/li&gt;&lt;#rt/&gt;
        &lt;/#if&gt;
    &lt;/#list&gt;
&lt;/#if&gt;
&lt;/ul&gt;</plain-text-body><p>&#160;</p><pre>controlfooter.ftl</pre><parameter ac:name="language">xml</parameter><plain-text-body>${parameters.after!}&lt;#t/&gt;
    &lt;/td&gt;&lt;#lt/&gt;
&lt;/tr&gt;
&lt;#if (parameters.errorposition!"top") == 'bottom'&gt;
&lt;#assign hasFieldErrors = parameters.name?? &amp;&amp; fieldErrors?? &amp;&amp; fieldErrors[parameters.name]??/&gt;
&lt;#if hasFieldErrors&gt;
&lt;tr errorFor="${parameters.id}"&gt;
    &lt;td class="tdErrorMessage" colspan="2"&gt;&lt;#rt/&gt;
        &lt;#if hasFieldErrors&gt;
            &lt;#list fieldErrors[parameters.name] as error&gt;
                &lt;div class="errorMessage"&gt;${error?html}&lt;/div&gt;&lt;#t/&gt;
            &lt;/#list&gt;
        &lt;/#if&gt;
    &lt;/td&gt;&lt;#lt/&gt;
&lt;/tr&gt;
&lt;/#if&gt;
&lt;/#if&gt;

</plain-text-body><p>&#160;</p><pre>controlheader-core.ftl</pre><parameter ac:name="language">xml</parameter><plain-text-body>&#160;&lt;#--
    Always include elements to show errors. They may be filled later via AJAX.
--&gt;
&lt;#assign hasFieldErrors = parameters.name?? &amp;&amp; fieldErrors?? &amp;&amp; fieldErrors[parameters.name]??/&gt;
&lt;#if (parameters.errorposition!"top") == 'top'&gt;
&lt;tr errorFor="${parameters.id}"&gt;
    &lt;td class="tdErrorMessage" colspan="2" data-error-for-fieldname="${parameters.name}"&gt;&lt;#rt/&gt;
        &lt;#if hasFieldErrors&gt;
            &lt;#list fieldErrors[parameters.name] as error&gt;
                &lt;div class="errorMessage"&gt;${error?html}&lt;/div&gt;&lt;#t/&gt;
            &lt;/#list&gt;
        &lt;/#if&gt;
    &lt;/td&gt;&lt;#lt/&gt;
&lt;/tr&gt;
&lt;/#if&gt;
&lt;#if !parameters.labelposition?? &amp;&amp; (parameters.form.labelposition)??&gt;
&lt;#assign labelpos = parameters.form.labelposition/&gt;
&lt;#elseif parameters.labelposition??&gt;
&lt;#assign labelpos = parameters.labelposition/&gt;
&lt;/#if&gt;
&lt;#--
    if the label position is top,
    then give the label it's own row in the table
--&gt;
&lt;tr&gt;
&lt;#if (labelpos!"") == 'top'&gt;
    &lt;td class="tdLabelTop" colspan="2"&gt;&lt;#rt/&gt;
&lt;#else&gt;
    &lt;td class="tdLabel"&gt;&lt;#rt/&gt;
&lt;/#if&gt;
&lt;#if parameters.label??&gt;
    &lt;label &lt;#t/&gt;
&lt;#if parameters.id??&gt;
        for="${parameters.id?html}" &lt;#t/&gt;
&lt;/#if&gt;
&lt;#if hasFieldErrors&gt;
        class="errorLabel"&lt;#t/&gt;
&lt;#else&gt;
        class="label"&lt;#t/&gt;
&lt;/#if&gt;
    &gt;&lt;#t/&gt;
&lt;#if parameters.required!false &amp;&amp; parameters.requiredPosition!"right" != 'right'&gt;
        &lt;span class="required"&gt;*&lt;/span&gt;&lt;#t/&gt;
&lt;/#if&gt;
${parameters.label?html}&lt;#t/&gt;
&lt;#if parameters.required!false &amp;&amp; parameters.requiredPosition!"right" == 'right'&gt;
 &lt;span class="required"&gt;*&lt;/span&gt;&lt;#t/&gt;
&lt;/#if&gt;
${parameters.labelseparator!":"?html}&lt;#t/&gt;
&lt;#include "/${parameters.templateDir}/${parameters.expandTheme}/tooltip.ftl" /&gt;
&lt;/label&gt;&lt;#t/&gt;
&lt;/#if&gt;
    &lt;/td&gt;&lt;#lt/&gt;
&lt;#-- add the extra row --&gt;
&lt;#if (labelpos!"") == 'top'&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/#if&gt;

</plain-text-body><h3 id="AJAXValidation-CSS">CSS</h3><p>To show users some nice visual feedback while waiting for AJAX response you can use a little CSS. Remember to include the referenced <em>indicator.gif</em>.</p><parameter ac:name="language">css</parameter><plain-text-body>.ajaxVisualFeedback {
    width: 16px;
    height: 16px;
    background-image: url('../images/indicator.gif');
    background-repeat: no-repeat;
    float: right;
}</plain-text-body><p>&#160;</p><h3 id="AJAXValidation-JavaScript">JavaScript</h3><p>Now this is where the magic happens. Here <em>jQuery</em> is used to register an eventhandler which intercepts form submits. It takes care of hiding validation errors that might be present, submit the form via AJAX and handle JSON responses.</p><parameter ac:name="language">js</parameter><plain-text-body> /**
  * Validates form per AJAX. To be called as onSubmit handler.
  *
  * @param event onSubmit event
  */
function ajaxFormValidation(event) {
    event.preventDefault();
    _removeValidationErrors();
    var _form = $(event.target);
    var _formData = _form.serialize(true);
    // prepare visual feedback
    // you may want to use other elements here
    var originalButton = _form.find('.btn-primary');
    // note: jQuery returns an array-like object
    if (originalButton &amp;&amp; originalButton.length &amp;&amp; originalButton.length &gt; 0) {
        originalButton.hide();
        var feedbackElement = $('&lt;div class="ajaxVisualFeedback"&gt;&lt;/div&gt;').insertAfter(originalButton);
        var restoreFunction = function() {
            originalButton.show();
            feedbackElement.remove();
        }
    }
    var options = {
        data: 'struts.enableJSONValidation=true&amp;struts.validateOnly=false&amp;' + _formData,
        async: true,
        processData: false,
        type: 'POST',
        success: function (response, statusText, xhr) {
            if (response.location) {
                // no validation errors
                // action has been executed and sent a redirect URL wrapped as JSON
                // cannot use a normal http-redirect (status-code 3xx) as this would be followed by browsers and would not be available here
                // follow JSON-redirect
                window.location.href = response.location;
            } else {
                if (restoreFunction) {
                    restoreFunction();
                }
                _handleValidationResult(_form, response);
            }
        },
        error: function(xhr, textStatus, errorThrown) {
            if (restoreFunction) {
                restoreFunction();
            }
            // struts sends status code 400 when validation errors are present
            if (xhr.status === 400) {
                _handleValidationResult(_form, JSON.parse(xhr.responseText))
            } else {
                // a real error occurred -&gt; show user an error message
                _handleValidationResult(_form, {errors: ['Network or server error!']})
            }
		}
    }
    // send request, after delay to make sure everybody notices the visual feedback :)
    window.setTimeout(function() {
        var url = _form[0].action;
        jQuery.ajax(url, options);
    }, 1000);
}
/**
 * Removes validation errors from HTML DOM.
 */
function _removeValidationErrors() {
    // action errors
    // you might want to use a custom ID here
    $('ul.errorMessage li').remove();
    // field errors
    $('div.errorMessage').remove();
}
/**
 * Incorporates validation errors in HTML DOM.
 *
 * @param form Form containing errors.
 * @param errors Errors from server.
 */
function _handleValidationResult(form, errors) {
    // action errors
    if (errors.errors) {
        // you might want to use a custom ID here
        var errorContainer = $('ul.errorMessage');
        $.each(errors.errors, function(index, errorMsg) {
            var li = $('&lt;li&gt;&lt;span&gt;&lt;/span&gt;&lt;/li&gt;');
            li.text(errorMsg); // use text() for security reasons
            errorContainer.append(li);
        });
    }
    // field errors
    if (errors.fieldErrors) {
        $.each(errors.fieldErrors, function(fieldName, errorMsg) {
            var td = $('td[data-error-for-fieldname="' + fieldName + '"]');
            if (td) {
                var div = $('&lt;div class="errorMessage"&gt;&lt;/div&gt;');
                div.text(errorMsg); // use text() for security reasons
                td.append(div);
            }
        });
    }
}
// register onSubmit handler
$(window).bind('load', function() {
    $('form').bind('submit', ajaxFormValidation);
});</plain-text-body><p>&#160;</p><h2 id="AJAXValidation-Howitworks">How it works</h2><p><em>jsonValidation</em> interceptor must be placed on a stack, following the <em>validation</em> interceptor. The interceptor itself won't perform any validation, but will check for validation errors on the action being invoked (assuming that the action is ValidationAware).</p><p>If you just want to use AJAX validation, without knowing the implementation details, you can skip this section.</p><p>When the <em>jsonValidation</em> interceptor is invoked, it will look for a parameter named <em>struts.enableJSONValidation</em>, this parameter <strong>must</strong> be set to <em>true</em>, otherwise the interceptor won't do anything. Then the interceptor will look for a parameter named <em>struts.validateOnly</em>, if this parameter exists, is set to <em>true</em>, and there are validation errors (o action errors) they will be serialized into JSON in the form:</p><parameter ac:name="">JavaScript</parameter><plain-text-body>{
    "errors": ["Global Error 1", "Global Error 2"],
    "fieldErrors": {
        "field1": ["Field 1 Error 1", "Field 1 Error 2"],
        "field1": ["Field 2 Error 1", "Field 2 Error 2"]  
    }
}
</plain-text-body><p>If the action implements the <em>ModelDrive</em> interface, "model." will be stripped from the field names in the returned JSON. If validation succeeds (and&#160;<em>struts.validateOnly</em> is true), an empty JSON string will be returned:</p><parameter ac:name="">JavaScript</parameter><plain-text-body>{}
</plain-text-body><p>If <em>struts.validateOnly</em> is false the action and result are executed. In this case <em>jsonActionRedirect</em> result is very useful. It creates a JSON response in the form:</p><parameter ac:name="">JavaScript</parameter><plain-text-body>{"location": "&lt;url to be loaded next&gt;"}
</plain-text-body><rich-text-body><p>Remember to set struts.enableJSONValidation=true in the request to enable AJAX validation</p></rich-text-body><h2 id="AJAXValidation-JSONValidationInterceptorparameters">JSONValidationInterceptor parameters</h2><p>The following request parameters can be used to enable exposing validation errors:</p><ul style="list-style-type: square;"><li><strong>struts.enableJSONValidation</strong> - a request parameter&#160;must be set to <strong>true</strong>&#160;to use this interceptor</li><li><strong>struts.validateOnly</strong> - If the request has this parameter, execution will return after validation (action won't be executed). If <strong>struts.validateOnly</strong>&#160;is set to false you may want to use <a shape="rect" class="createlink" href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=WW&amp;title=JSONActionRedirectResult&amp;linkCreation=true&amp;fromPageId=13850">JSONActionRedirectResult</a></li><li><strong>struts.JSONValidation.no.encoding</strong> - If the request has this parameter set to<strong> true,</strong> the character encoding will <strong>NOT</strong> be set on the response - is needed in portlet environment</li></ul><p>You can override names of these parameters by specifying the following parameters when setting up a stack:</p><ul style="list-style-type: square;"><li><strong>validateJsonParam</strong>&#160;- to override name of&#160;<strong>struts.enableJSONValidation</strong><strong><br clear="none"></strong></li><li><strong>validateOnlyParam</strong> - to override name of <strong>struts.validateOnly</strong></li><li><strong>noEncodingSetParam</strong> - to override name of&#160;<strong>struts.JSONValidation.no.encoding</strong></li><li><strong>validationFailedStatus</strong> - status to be set on response when there are validation errors, by default <strong>400</strong></li></ul><p><strong><br clear="none"></strong></p><rich-text-body>&#160;Parameters overriding is available since Struts 2.5.9</rich-text-body><h2 id="AJAXValidation-FlowchartofAJAXvalidation">Flow chart of AJAX validation</h2><parameter ac:name="">Client Validation</parameter><rich-text-body><p>Some details are omitted, like results used.</p></rich-text-body><parameter ac:name="">Client Validation</parameter><rich-text-body><p>As explained above: there is a case where form is submitted twice, one time as AJAX with validation only and another time as usual submit.</p></rich-text-body><p><a shape="rect" href="ajax-validation.data/struts2-ajax-vali-flow.png?version=2&amp;modificationDate=1454052624000&amp;api=v2" data-linked-resource-id="61338002" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="struts2-ajax-vali-flow.png" data-nice-type="Image" data-linked-resource-content-type="image/png" data-linked-resource-container-id="13850" data-linked-resource-container-version="48"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="ajax-validation.data/struts2-ajax-vali-flow.png"></span></a></p><p>&#160;</p></div>
        </div>

        
    </div>
</div>
<div class="footer">
    Generated by CXF SiteExporter
</div>
</body>
</html>
