<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="Date-Revision-yyyymmdd" content="20140918"/>
  <meta http-equiv="Content-Language" content="en"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Convention plugin</title>

  <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,400italic,600italic,700italic" rel="stylesheet" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <link href="/css/main.css" rel="stylesheet">
  <link href="/css/custom.css" rel="stylesheet">
  <link href="/highlighter/github-theme.css" rel="stylesheet">

  <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
  <script type="text/javascript" src="/bootstrap/js/bootstrap.js"></script>
  <script type="text/javascript" src="/js/community.js"></script>
</head>
<body>

<a href="http://github.com/apache/struts" class="github-ribbon">
  <img style="position: absolute; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub">
</a>

<header>
  <nav>
    <div role="navigation" class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" data-toggle="collapse" data-target="#struts-menu" class="navbar-toggle">
            Menu
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="/index.html" class="navbar-brand logo"><img src="/img/struts-logo.svg"></a>
        </div>
        <div id="struts-menu" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                Home<b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                <li><a href="/index.html">Welcome</a></li>
                <li><a href="/download.cgi">Download</a></li>
                <li><a href="/releases.html">Releases</a></li>
                <li><a href="/announce.html">Announcements</a></li>
                <li><a href="http://www.apache.org/licenses/">License</a></li>
                <li><a href="https://www.apache.org/foundation/thanks.html">Thanks!</a></li>
                <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                Support<b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                <li><a href="/mail.html">User Mailing List</a></li>
                <li><a href="https://issues.apache.org/jira/browse/WW">Issue Tracker</a></li>
                <li><a href="/security.html">Reporting Security Issues</a></li>
                <li class="divider"></li>
                <li><a href="https://cwiki.apache.org/confluence/display/WW/Migration+Guide">Version Notes</a></li>
                <li><a href="https://cwiki.apache.org/confluence/display/WW/Security+Bulletins">Security Bulletins</a></li>
                <li class="divider"></li>
                <li><a href="/maven/project-info.html">Maven Project Info</a></li>
                <li><a href="/maven/struts2-core/dependencies.html">Struts Core Dependencies</a></li>
                <li><a href="/maven/struts2-plugins/modules.html">Plugin Dependencies</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                Documentation<b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                <li><a href="/birdseye.html">Birds Eye</a></li>
                <li><a href="/primer.html">Key Technologies</a></li>
                <li><a href="/kickstart.html">Kickstart FAQ</a></li>
                <li><a href="https://cwiki.apache.org/confluence/display/WW/Home">Wiki</a></li>
                <li class="divider"></li>
                <li><a href="/getting-started/">Getting Started</a></li>
                <li><a href="/security/">Security Guide</a></li>
                <li><a href="/core-developers/">Core Developers Guide</a></li>
                <li><a href="/tag-developers/">Tag Developers Guide</a></li>
                <li><a href="/maven-archetypes/">Maven Archetypes</a></li>
                <li><a href="/plugins/">Plugins</a></li>
                <li><a href="/maven/struts2-core/apidocs/index.html">Struts Core API</a></li>
                <li><a href="/tag-developers/tag-reference.html">Tag reference</a></li>
                <li><a href="https://cwiki.apache.org/confluence/display/WW/FAQs">FAQs</a></li>
                <li><a href="http://cwiki.apache.org/S2PLUGINS/home.html">Plugin registry</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                Contributing<b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                <li><a href="/youatstruts.html">You at Struts</a></li>
                <li><a href="/helping.html">How to Help FAQ</a></li>
                <li><a href="/dev-mail.html">Development Lists</a></li>
                <li class="divider"></li>
                <li><a href="/submitting-patches.html">Submitting patches</a></li>
                <li><a href="/builds.html">Source Code and Builds</a></li>
                <li><a href="/coding-standards.html">Coding standards</a></li>
                <li><a href="https://cwiki.apache.org/confluence/display/WW/Contributors+Guide">Contributors Guide</a></li>
                <li class="divider"></li>
                <li><a href="/release-guidelines.html">Release Guidelines</a></li>
                <li><a href="/bylaws.html">PMC Charter</a></li>
                <li><a href="/volunteers.html">Volunteers</a></li>
                <li><a href="https://git-wip-us.apache.org/repos/asf?p=struts.git">Source Repository</a></li>
              </ul>
            </li>
            <li class="apache"><a href="http://www.apache.org/"><img src="/img/apache.png"></a></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>
</header>


<article class="container">
  <section class="col-md-12">
    <a href="../" title="back to Plugins"><< back to Plugins</a>
    <a class="edit-on-gh" href="https://github.com/apache/struts-site/edit/master/source/plugins/junit/index.md" title="Edit this page on GitHub">Edit on GitHub</a>
    <h1 class="no_toc" id="junit-plugin">JUnit plugin</h1>

<ul id="markdown-toc">
  <li><a href="#struts-actions-without-spring" id="markdown-toc-struts-actions-without-spring">Struts actions (without Spring)</a></li>
  <li><a href="#the-template" id="markdown-toc-the-template">The template</a></li>
  <li><a href="#struts-actions-using-spring" id="markdown-toc-struts-actions-using-spring">Struts Actions using Spring</a></li>
</ul>

<p>The recommended way to test actions is to instantiate the action classes and test them. The <em>JUnit Plugin</em>  supports 
testing actions within a Struts invocation, meaning that a full request is simulated, and the output of the action can 
be tested.</p>

<h2 id="struts-actions-without-spring">Struts actions (without Spring)</h2>

<p>To test actions that do not use Spring, extend <code class="highlighter-rouge">StrutsTestCase</code>. The following example shows different ways of testing 
an action:</p>

<ul>
  <li>Mapping:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;struts&gt;</span>
    <span class="nt">&lt;constant</span> <span class="na">name=</span><span class="s">"struts.objectFactory"</span> <span class="na">value=</span><span class="s">"spring"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">"test"</span> <span class="na">namespace=</span><span class="s">"/test"</span> <span class="na">extends=</span><span class="s">"struts-default"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">name=</span><span class="s">"testAction"</span> <span class="na">class=</span><span class="s">"org.apache.struts2.TestAction"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">type=</span><span class="s">"freemarker"</span><span class="nt">&gt;</span>/template.ftl<span class="nt">&lt;/result&gt;</span>
        <span class="nt">&lt;/action&gt;</span>
    <span class="nt">&lt;/package&gt;</span>
<span class="nt">&lt;/struts&gt;</span>
</code></pre>
</div>

<ul>
  <li>Action:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestAction</span> <span class="kd">extends</span> <span class="n">ActionSupport</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="n">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="n">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<ul>
  <li>JUnit:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">struts2</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.struts2.dispatcher.mapper.ActionMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.UnsupportedEncodingException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.opensymphony.xwork2.ActionProxy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.opensymphony.xwork2.Action</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StrutsTestCaseTest</span> <span class="kd">extends</span> <span class="n">StrutsTestCase</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">testGetActionMapping</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">ActionMapping</span> <span class="n">mapping</span> <span class="o">=</span> <span class="n">getActionMapping</span><span class="o">(</span><span class="s">"/test/testAction.action"</span><span class="o">);</span>
        <span class="n">assertNotNull</span><span class="o">(</span><span class="n">mapping</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="s">"/test"</span><span class="o">,</span> <span class="n">mapping</span><span class="o">.</span><span class="na">getNamespace</span><span class="o">());</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="s">"testAction"</span><span class="o">,</span> <span class="n">mapping</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="n">testGetActionProxy</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">//set parameters before calling getActionProxy</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"FD"</span><span class="o">);</span>
        
        <span class="n">ActionProxy</span> <span class="n">proxy</span> <span class="o">=</span> <span class="n">getActionProxy</span><span class="o">(</span><span class="s">"/test/testAction.action"</span><span class="o">);</span>
        <span class="n">assertNotNull</span><span class="o">(</span><span class="n">proxy</span><span class="o">);</span>

        <span class="n">TestAction</span> <span class="n">action</span> <span class="o">=</span> <span class="o">(</span><span class="n">TestAction</span><span class="o">)</span> <span class="n">proxy</span><span class="o">.</span><span class="na">getAction</span><span class="o">();</span>
        <span class="n">assertNotNull</span><span class="o">(</span><span class="n">action</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="n">Action</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="s">"FD"</span><span class="o">,</span> <span class="n">action</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="n">testExecuteAction</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">UnsupportedEncodingException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">output</span> <span class="o">=</span> <span class="n">executeAction</span><span class="o">(</span><span class="s">"/test/testAction.action"</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="s">"Hello"</span><span class="o">,</span> <span class="n">output</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="n">testGetValueFromStack</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">UnsupportedEncodingException</span> <span class="o">{</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"FD"</span><span class="o">);</span>
        <span class="n">executeAction</span><span class="o">(</span><span class="s">"/test/testAction.action"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">findValueAfterExecute</span><span class="o">(</span><span class="s">"name"</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="s">"FD"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="the-template">The template</h2>

<p>If you use JSPs as the template engine you won’t be able to test the action output outside the container. 
The <a href="../embeddedjsp/">Embedded JSP Plugin</a> can be used to overcome this limitation and be able to use JSPs from 
the classpath and outside the container.</p>

<p>There are several utility methods and mock objects defined in StrutsTestCase which can be used to facilitate the testing:</p>

<ul>
  <li>Methods:</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Method Name</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>executeAction(String)</td>
      <td>Pass the url for the action, and it will return the output of the action. This output <strong>is not</strong> the action result, like “success”, but what would be written to the result stream. To use this the actions must be using a result type that can be read from the classpath, like FreeMarker, velocity, etc (if you are using the experimental Embedded JSP Plugin, you can use JSPs also)</td>
    </tr>
    <tr>
      <td>getActionProxy(String)</td>
      <td>Builds an action proxy that can be used to invoke an action, by calling execute() on the returned proxy object. The return value of execute() is the action result, like “success”</td>
    </tr>
    <tr>
      <td>getActionMapping(String)</td>
      <td>Gets an ActionMapping for the url</td>
    </tr>
    <tr>
      <td>injectStrutsDependencies(object)</td>
      <td>Injects Struts dependencies into an object (dependencies are marked with Inject)</td>
    </tr>
    <tr>
      <td>findValueAfterExecute(String)</td>
      <td>Finds an object in the value stack, after an action has been executed</td>
    </tr>
    <tr>
      <td>applyAdditionalParams(ActionContext)</td>
      <td>Can be overwritten in subclass to provide additional params and settings used during action invocation</td>
    </tr>
    <tr>
      <td>createAction(Class)</td>
      <td>Can be used to instantiate an action which requires framework’s dependencies to be injected (e.g. extending ActionSupport requires inject some internal dependencies)</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>Fields:</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>MockHttpServletRequest request</td>
      <td>The request that will be passed to Struts. Make sure to set parameters in this object before calling methods like getActionProxy</td>
    </tr>
    <tr>
      <td>MockHttpServletResponse response</td>
      <td>The response object passed to Struts, you can use this class to test the output, response headers, etc</td>
    </tr>
    <tr>
      <td>MockServletContext servletContext</td>
      <td>The servlet context object passed to Struts</td>
    </tr>
  </tbody>
</table>

<h2 id="struts-actions-using-spring">Struts Actions using Spring</h2>

<p>Make sure to add a dependency to the <a href="../spring/">Spring Plugin</a> to your <code class="highlighter-rouge">pom.xml</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.struts<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>struts2-spring-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>STRUTS_VERSION<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre>
</div>

<p>If you use Spring as the object factory, the <code class="highlighter-rouge">StrutsSpringTestCase</code> class can be used to write your JUnits. This class 
extends <code class="highlighter-rouge">StrutsTestCase</code> and has an <code class="highlighter-rouge">applicationContext</code> field of type <code class="highlighter-rouge">ApplicationContext</code>.</p>

<p>The Spring context is loaded from <code class="highlighter-rouge">classpath\*:applicationContext.xml</code> by default. To provide a different location, 
overwrite <code class="highlighter-rouge">getContextLocations</code>.</p>

  </section>
</article>


<footer class="container">
  <div class="col-md-12">
    Copyright &copy; 2000-2018 <a href="http://www.apache.org/">The Apache Software Foundation </a>.
    All Rights Reserved.
  </div>
  <div class="col-md-12">
    Apache Struts, Struts, Apache, the Apache feather logo, and the Apache Struts project logos are
    trademarks of The Apache Software Foundation.
  </div>
  <div class="col-md-12">Logo and website design donated by <a href="https://softwaremill.com/">SoftwareMill</a>.</div>
</footer>

<script>!function (d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (!d.getElementById(id)) {
    js = d.createElement(s);
    js.id = id;
    js.src = "//platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js, fjs);
  }
}(document, "script", "twitter-wjs");</script>
<script src="https://apis.google.com/js/platform.js" async="async" defer="defer"></script>

<div id="fb-root"></div>

<script>(function (d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s);
  js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


</body>
</html>
